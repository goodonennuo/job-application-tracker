<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ITå²—ä½æ±‚èŒè®°å½•ç³»ç»Ÿ - å²—ä½åˆ—è¡¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .header {
            background-color: #343a40;
            color: white;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        .footer {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #f1f1f1;
            text-align: center;
        }
        .student-info {
            float: right;
            font-size: 0.9rem;
        }
        .modal-header {
            background-color: #343a40;
            color: white;
        }
        .modal-header .close {
            color: white;
        }
        .debug-info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="header">
    <div class="container">
        <h1>ITå²—ä½æ±‚èŒè®°å½•ç³»ç»Ÿ</h1>
        <div class="student-info">
            <span th:text="'å§“åï¼š' + ${studentName}">å§“åï¼šéƒä¸€è¯º</span> |
            <span th:text="'ç­çº§ï¼š' + ${studentClass}">ç­çº§ï¼šä¿¡2305-3</span>
        </div>
    </div>
</div>

<div class="container">
<!--    &lt;!&ndash; è°ƒè¯•ä¿¡æ¯åŒºåŸŸ &ndash;&gt;-->
<!--    <div class="debug-info">-->
<!--        <h5>ğŸ” è°ƒè¯•ä¿¡æ¯</h5>-->
<!--        <p>æ•°æ®åˆ—è¡¨æ˜¯å¦ä¸ºç©º: <strong th:text="${jobs == null} ? 'æ˜¯(null)' : (${jobs.isEmpty()} ? 'æ˜¯(ç©ºåˆ—è¡¨)' : 'å¦')">æœªçŸ¥</strong></p>-->
<!--        <p>æ•°æ®æ¡æ•°: <strong th:text="${jobs != null} ? ${jobs.size()} : 0">0</strong></p>-->
<!--        <p>æœç´¢å…³é”®è¯: <strong th:text="${keyword != null} ? ${keyword} : 'æ— '">æ— </strong></p>-->
<!--        <p>å­¦ç”Ÿä¿¡æ¯: <span th:text="${studentName} + ' - ' + ${studentClass}">æœªçŸ¥</span></p>-->

<!--        &lt;!&ndash; æ˜¾ç¤ºè¯¦ç»†æ•°æ® &ndash;&gt;-->
<!--        <div th:if="${jobs != null and !jobs.isEmpty()}">-->
<!--            <h6>æ•°æ®è¯¦æƒ…:</h6>-->
<!--            <div th:each="job,iter : ${jobs}">-->
<!--                <small>-->
<!--                    [#<span th:text="${iter.index}"></span>]-->
<!--                    ID:<span th:text="${job.id}"></span> |-->
<!--                    ä¼ä¸š:<span th:text="${job.companyName}"></span> |-->
<!--                    å²—ä½:<span th:text="${job.positionName}"></span> |-->
<!--                    è–ªèµ„:<span th:text="${job.salary}"></span>-->
<!--                </small>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

    <div class="row mb-3">
        <div class="col-md-6">
            <form action="/jobs" method="get" class="form-inline">
                <input type="text" name="keyword" th:value="${keyword}" placeholder="æœç´¢ä¼ä¸š/å²—ä½/åœ°ç‚¹" class="form-control mr-2">
                <button type="submit" class="btn btn-success">æœç´¢</button>
            </form>
        </div>
        <div class="col-md-6 text-right">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addJobModal">
                æ·»åŠ å²—ä½
            </button>
            <!-- æµ‹è¯•æŒ‰é’® -->
            <a href="/jobs/test" class="btn btn-info ml-2">æµ‹è¯•é¡µé¢</a>
        </div>
    </div>
    
    <!-- å¤šæ¡ä»¶æŸ¥è¯¢è¡¨å• -->
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    å¤šæ¡ä»¶ç­›é€‰
                </div>
                <div class="card-body">
                    <form action="/jobs" method="get" class="form-row">
                        <div class="form-group col-md-4">
                            <label for="positionName">å²—ä½åç§°</label>
                            <select class="form-control" id="positionName" name="positionName">
                                <option value="">å…¨éƒ¨å²—ä½</option>
                                <option th:selected="${positionName == 'Javaå¼€å‘å·¥ç¨‹å¸ˆ'}" value="Javaå¼€å‘å·¥ç¨‹å¸ˆ">Javaå¼€å‘å·¥ç¨‹å¸ˆ</option>
                                <option th:selected="${positionName == 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ'}" value="å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ">å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ</option>
                                <option th:selected="${positionName == 'æµ‹è¯•å·¥ç¨‹å¸ˆ'}" value="æµ‹è¯•å·¥ç¨‹å¸ˆ">æµ‹è¯•å·¥ç¨‹å¸ˆ</option>
                                <option th:selected="${positionName == 'äº§å“ç»ç†'}" value="äº§å“ç»ç†">äº§å“ç»ç†</option>
                                <option th:selected="${positionName == 'ç½‘ç»œå·¥ç¨‹å¸ˆ'}" value="ç½‘ç»œå·¥ç¨‹å¸ˆ">ç½‘ç»œå·¥ç¨‹å¸ˆ</option>
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="salary">è–ªèµ„</label>
                            <select class="form-control" id="salary" name="salary">
                                <option value="">å…¨éƒ¨è–ªèµ„</option>
                                <option th:selected="${salary == '18K-25K'}" value="18K-25K">18K-25K</option>
                                <option th:selected="${salary == '20K-30K'}" value="20K-30K">20K-30K</option>
                                <option th:selected="${salary == '25K-35K'}" value="25K-35K">25K-35K</option>
                                <option th:selected="${salary == '25K-40K'}" value="25K-40K">25K-40K</option>
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="location">å·¥ä½œåœ°ç‚¹</label>
                            <select class="form-control" id="location" name="location">
                                <option value="">å…¨éƒ¨åœ°ç‚¹</option>
                                <option th:selected="${location == 'æ­å·'}" value="æ­å·">æ­å·</option>
                                <option th:selected="${location == 'æ·±åœ³'}" value="æ·±åœ³">æ·±åœ³</option>
                                <option th:selected="${location == 'åŒ—äº¬'}" value="åŒ—äº¬">åŒ—äº¬</option>
                            </select>
                        </div>
                        <div class="col-md-12 text-right">
                            <button type="submit" class="btn btn-primary">ç­›é€‰</button>
                            <a href="/jobs" class="btn btn-secondary ml-2">æ¸…é™¤ç­›é€‰</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- æ˜¾ç¤ºæ•°æ®è¡¨æ ¼ -->
    <div th:if="${jobs != null and !jobs.isEmpty()}">
        <table id="jobsTable" class="table table-striped table-bordered">
            <thead class="thead-dark">
            <tr>
                <th>ID</th>
                <th>ä¼ä¸šåç§°</th>
                <th>å²—ä½åç§°</th>
                <th>è–ªèµ„</th>
                <th>å·¥ä½œåœ°ç‚¹</th>
                <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="job : ${jobs}">
                <td th:text="${job.id}">ID</td>
                <td th:text="${job.companyName}">ä¼ä¸šåç§°</td>
                <td th:text="${job.positionName}">å²—ä½åç§°</td>
                <td th:text="${job.salary}">è–ªèµ„</td>
                <td th:text="${job.location}">å·¥ä½œåœ°ç‚¹</td>
                <td>
                    <button type="button" class="btn btn-warning btn-sm mr-1" data-toggle="modal"
                            data-target="#editJobModal" th:data-id="${job.id}" onclick="fillEditForm(this)">
                        ç¼–è¾‘
                    </button>
                    <a th:href="@{/jobs/delete/{id}(id=${job.id})}" class="btn btn-danger btn-sm"
                       onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¯¥å²—ä½å—ï¼Ÿ')">åˆ é™¤</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- æ— æ•°æ®æ—¶æ˜¾ç¤º -->
    <div th:if="${jobs == null or jobs.isEmpty()}" class="alert alert-warning">
        âš ï¸ æš‚æ— å²—ä½ä¿¡æ¯ -
        <span th:if="${jobs == null}">æ•°æ®åˆ—è¡¨ä¸º null</span>
        <span th:if="${jobs != null and jobs.isEmpty()}">æ•°æ®åˆ—è¡¨ä¸ºç©ºæ•°ç»„</span>
    </div>
</div>

<div class="footer">
    <p>&copy; 2025 ITå²—ä½æ±‚èŒè®°å½•ç³»ç»Ÿ</p>
</div>

<!-- æ·»åŠ å²—ä½çš„æ¨¡æ€æ¡† -->
<div class="modal fade" id="addJobModal" tabindex="-1" role="dialog" aria-labelledby="addJobModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addJobModalLabel">æ·»åŠ å²—ä½ä¿¡æ¯</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addJobForm" action="/jobs/add" method="post">
                    <div class="form-group">
                        <label for="companyName">ä¼ä¸šåç§° *</label>
                        <input type="text" class="form-control" id="companyName" name="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="positionName">å²—ä½åç§° *</label>
                        <input type="text" class="form-control" id="positionName" name="positionName" required>
                    </div>
                    <div class="form-group">
                        <label for="salary">è–ªèµ„ *</label>
                        <input type="text" class="form-control" id="salary" name="salary" required>
                    </div>
                    <div class="form-group">
                        <label for="location">å·¥ä½œåœ°ç‚¹ *</label>
                        <input type="text" class="form-control" id="location" name="location" required>
                    </div>
                    <div class="form-group">
                        <label for="requirements">å…·ä½“è¦æ±‚</label>
                        <textarea class="form-control" id="requirements" name="requirements" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contactInfo">è”ç³»æ–¹å¼</label>
                        <input type="text" class="form-control" id="contactInfo" name="contactInfo">
                    </div>
                    <div class="form-group">
                        <label for="note">å¤‡æ³¨</label>
                        <textarea class="form-control" id="note" name="note" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('addJobForm').submit()">ä¿å­˜</button>
            </div>
        </div>
    </div>
</div>

<!-- ç¼–è¾‘å²—ä½çš„æ¨¡æ€æ¡† -->
<div class="modal fade" id="editJobModal" tabindex="-1" role="dialog" aria-labelledby="editJobModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editJobModalLabel">ç¼–è¾‘å²—ä½ä¿¡æ¯</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editJobForm" action="/jobs/edit" method="post">
                    <input type="hidden" id="editId" name="id">
                    <div class="form-group">
                        <label for="editCompanyName">ä¼ä¸šåç§° *</label>
                        <input type="text" class="form-control" id="editCompanyName" name="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="editPositionName">å²—ä½åç§° *</label>
                        <input type="text" class="form-control" id="editPositionName" name="positionName" required>
                    </div>
                    <div class="form-group">
                        <label for="editSalary">è–ªèµ„ *</label>
                        <input type="text" class="form-control" id="editSalary" name="salary" required>
                    </div>
                    <div class="form-group">
                        <label for="editLocation">å·¥ä½œåœ°ç‚¹ *</label>
                        <input type="text" class="form-control" id="editLocation" name="location" required>
                    </div>
                    <div class="form-group">
                        <label for="editRequirements">å…·ä½“è¦æ±‚</label>
                        <textarea class="form-control" id="editRequirements" name="requirements" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editContactInfo">è”ç³»æ–¹å¼</label>
                        <input type="text" class="form-control" id="editContactInfo" name="contactInfo">
                    </div>
                    <div class="form-group">
                        <label for="editNote">å¤‡æ³¨</label>
                        <textarea class="form-control" id="editNote" name="note" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('editJobForm').submit()">æ›´æ–°</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // å¡«å……ç¼–è¾‘è¡¨å•
    function fillEditForm(button) {
        const jobId = $(button).data('id');
        console.log('Editing job ID:', jobId);

        // ä½¿ç”¨AJAXè·å–å²—ä½çš„å®Œæ•´ä¿¡æ¯
        $.ajax({
            url: '/jobs/view-json/' + jobId,
            type: 'GET',
            dataType: 'json',
            success: function(job) {
                if (job) {
                    $('#editId').val(job.id);
                    $('#editCompanyName').val(job.companyName || '');
                    $('#editPositionName').val(job.positionName || '');
                    $('#editSalary').val(job.salary || '');
                    $('#editLocation').val(job.location || '');
                    $('#editRequirements').val(job.requirements || '');
                    $('#editContactInfo').val(job.contactInfo || '');
                    $('#editNote').val(job.note || '');
                }
            },
            error: function(xhr, status, error) {
                console.error('Error fetching job details:', error);
                alert('è·å–å²—ä½ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                $('#editJobModal').modal('hide');
            }
        });
    }

    // æ¨¡æ€æ¡†å…³é—­æ—¶é‡ç½®è¡¨å•
    $('#addJobModal').on('hidden.bs.modal', function () {
        document.getElementById('addJobForm').reset();
    });

    $('#editJobModal').on('hidden.bs.modal', function () {
        document.getElementById('editJobForm').reset();
    });

    // é¡µé¢åŠ è½½å®Œæˆåçš„è°ƒè¯•
    $(document).ready(function() {
        console.log('é¡µé¢åŠ è½½å®Œæˆ');
    });
</script>
</body>
</html>